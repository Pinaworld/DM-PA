
<head>
    <!-- Required meta tags-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Colorlib Templates">
    <meta name="author" content="Colorlib">
    <meta name="keywords" content="Colorlib Templates">


    <!-- Title Page-->
    <title>Enregistrement Anonnce</title>

   <script type="text/javascript">
    var idcompany = sessionStorage.idC;
    var token = sessionStorage.token;

    if(idcompany == undefined || token == undefined){
      document.location.href="index.html";
    }
   </script>

    <!-- Icons font CSS-->
    <link href="vendor/mdi-font/css/material-design-iconic-font.min.css" rel="stylesheet" media="all">
    <link href="vendor/font-awesome-4.7/css/font-awesome.min.css" rel="stylesheet" media="all">
    <!-- Font special for pages-->
    <link href="https://fonts.googleapis.com/css?family=Poppins:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet">

    <!-- Vendor CSS-->
    <link href="vendor/select2/select2.min.css" rel="stylesheet" media="all">
    <link href="vendor/datepicker/daterangepicker.css" rel="stylesheet" media="all">

    <!-- Main CSS-->
    <link href="css/mainRegistration.css" rel="stylesheet" media="all">
</head>

<body>
    <div class="page-wrapper bg-gra-02 p-t-130 p-b-100 font-poppins">
        <div class="wrapper wrapper--w680">
            <div class="card card-4">
                <div class="card-body">
                    <button class="buttonreturn" onclick="Retour()" >
                        <img src="images/return.png">
                    </button>
                    <h2 class="title"> Modifiez votre annonce !</h2>
                    <form >
                        <div class="row row-space">
                            <div class="col-2">
                                <div class="input-group">
                                    <label class="label">Choisissez une date</label>
                                    <div class="input-group-icon">
                                        <input class="input--style-4" id="datefield" type="date" name="date" min="">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row row-space">
                            <div>
                                <div class="input-group">
                                    <label class="label">Nombre de carton large (taille L)  </label>
                                    <input class="input--style-4" type="number" name="nb_carton_L" id="cartonL" min="0">
                                </div>
                            </div>
                        </div>
                        <div  class="row row-space">
                            <div>
                                <div class="input-group">
                                    <label class="label">Nombre de carton médium (taille M)  </label>
                                    <input class="input--style-4" type="number" name="nb_carton_M" id="cartonM" min="0">
                                </div>
                            </div>
                        </div>
                        <div class="row row-space">
                            <div>
                                <div class="input-group">
                                    <label class="label">Nombre de carton small (taille s)  </label>
                                    <input class="input--style-4" type="number" name="nb_carton_S"  id="cartonS" min="0">
                                </div>
                            </div>
                        </div>
                         <div class="row row-space">
                            <div>
                                <div class="input-group">
                                    <label class="label">Description de l'annonce </label>
                                    <textarea class="input--style-4" type="text" name="description_annonce"  id="description"></textarea>
                                </div>
                            </div>
                        </div>
                        <div class="p-t-15">
                            <button class="btn btn--radius-2 btn--blue" onclick="ModificationAdvertisement()">Enregistrer</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
        <!-- Jquery JS-->
    <script src="vendor/jquery/jquery.min.js"></script>
    <!-- Vendor JS-->
    <script src="vendor/select2/select2.min.js"></script>
    <script src="vendor/datepicker/moment.min.js"></script>
    <script src="vendor/datepicker/daterangepicker.js"></script>

    <!-- Main JS-->
    <script src="js/global.js"></script>

      <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script type="text/javascript">

    var idCompany = sessionStorage.idC;
    var urlSplit = document.location.href.split('?');
    var idAvertisement1 = urlSplit[1];
    var idAvertisement = parseInt(idAvertisement1, 10);
    if (isNaN(idAvertisement)) { document.location.href="HomePage.html"; }

    //window.history.pushState("object or string", "Title", "ModificationAnnonce.html");
    $.ajax({
          type: "GET",
          url: "http://127.0.0.1:8081/advertisement/" + idCompany +"/"+ idAvertisement,
          contentType: "application/json; charset=utf-8",
          
          dataType: "json",
        success: function( result){
                $(result).each(function (index, m){
                    var date = m.availabilityDate.split("T");
                    document.getElementById("datefield").value = date[0];
                    document.getElementById("cartonL").value = m.large;
                    document.getElementById("cartonM").value = m.medium;
                    document.getElementById("cartonS").value = m.small;
                    document.getElementById("description").value = m.description;
                })
            },
            error: function (errormessage) {
            alert("erreur lors du get advertisement");
        }
    });

    // date du jour minimum pour le datepicker
    var today = new Date();
    var dd = today.getDate();
    var mm = today.getMonth()+1;
    var yyyy = today.getFullYear();
     if(dd<10){
            dd='0'+dd
        } 
        if(mm<10){
            mm='0'+mm
        } 

    today = yyyy+'-'+mm+'-'+dd;
    document.getElementById("datefield").setAttribute("min", today);
    document.getElementById("datefield").setAttribute("min", today);

function ModificationAdvertisement(){
    var availabilityDate = document.getElementById("datefield").value;
    var description = document.getElementById("description").value;
    var large = document.getElementById("cartonL").value;
    var medium = document.getElementById("cartonM").value;
    var small = document.getElementById("cartonS").value;
    if(large.lenght == 0){
        large = "0";
    }else{
        var valLarge = parseInt(large, 10);
        if (isNaN(valLarge) || valLarge <= 0) { large = 0; }
    }
    if(medium.lenght <= 0){
        medium = "0";
    }else{
        var valMedium = parseInt(medium, 10);
        if (isNaN(valLarge) || valLarge <= 0) { large = 0; }
    }
    if(small.lenght <= 0){
        small = "0";
    }else{
        var valSmall = parseInt(small, 10);
        if (isNaN(valLarge) || valLarge <= 0) { large = 0; }
    }
    $.ajax({
          type: "PUT",
          url: "http://127.0.0.1:8081/advertisement/" + idCompany + "/" +idAvertisement,
          
          data: {
            idAvertisement: idAvertisement,
            availabilityDate: availabilityDate,
            description: description,
            large: large,
            medium: medium,
            small: small,
            idCompany: idCompany
          },
        success: function( result){
            console.log(result);

            if (result != undefined){
                document.location.href="HomePage.html";
                //document.location.href="RegistrationEntreprise.html";
            }
            
        },
        error: function (errormessage) {
            alert("problème lors de la mise à jour de l'annonce");
        },
        complete: function(result){
            document.location.href="HomePage.html";
        } 
    });
   // document.location.href="HomePage.html";
}

function Retour(){
    document.location.href="HomePage.html";
}
</script>

</body>